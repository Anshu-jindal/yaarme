// sidebar mobile
const sidebar = document.querySelector(".sidebar");
const blurBackground = function () {
    sidebar.style.boxShadow =
        "0px 0px 20px 5000px #00000094";
    document.querySelector(".container").style.pointerEvents = "none";
    document.querySelector(".mobile-header").style.pointerEvents = "none";
    document.querySelector(".mobile-nav-bar").style.pointerEvents = "none";
};
const removeBlurBackground = function () {
    sidebar.style.boxShadow = "none";
    document.querySelector(".container").style.pointerEvents = "auto";
    document.querySelector(".mobile-header").style.pointerEvents = "auto";
    document.querySelector(".mobile-nav-bar").style.pointerEvents = "auto";
};


// sidebar open
document.querySelector(".mobile-header .me-icon").addEventListener("click", function () {
    sidebar.style.left = 0;
    sidebar.style.top = 0;
    // blur background
    blurBackground();
});

//sidebar close
document.querySelector(".container-wrap").addEventListener("click", function () {
    sidebar.style.left = "";
    sidebar.style.top = "";
    // unblur background
    removeBlurBackground();
});


document.querySelector(".sidebar .down").addEventListener("click", function () {
    this.classList.toggle("rotate-arrow");
});

document.querySelector(".expand-add-acc").addEventListener("click", function () {
    document.querySelector(".all-uls").classList.toggle("show-add-acc");
});

function hide_mob_nb() {
    document.querySelector(".mobile-nav-bar").style.bottom = "-55px";
}





//Scroll Suggestions
const next_btn = document.querySelector(".next");
const previous_btn = document.querySelector(".previous");

const wrapper = document.querySelector(".suggestions-list");

let scrollMovePoint = 0;
const max_scroll = wrapper.scrollWidth;

function test(event) {
    let operand = 300;

    // Calculate the number to move.
    if (event.target.classList.contains("next")) {
        if (scrollMovePoint < max_scroll) {
            scrollMovePoint = scrollMovePoint + operand;
        }
    } else if (event.target.classList.contains("previous")) {
        if (0 < scrollMovePoint) {
            scrollMovePoint = scrollMovePoint - operand;
        }
    }

    // Move the scroll bar to the value.
    wrapper.scroll(scrollMovePoint, 0);
}
next_btn.addEventListener("click", test);
previous_btn.addEventListener("click", test);

//Scroll Story
const nxt_btn = document.querySelector(".nxt");
const prev_btn = document.querySelector(".prev");

const wrapperStory = document.querySelector(".scroll-stories");

let scrollStoryMovePoint = 0;
const maxStory_scroll = wrapperStory.scrollWidth;

function testStory(event) {
    let operandStory = 300;

    // Calculate the number to move.
    if (event.target.classList.contains("nxt")) {
        if (scrollStoryMovePoint < maxStory_scroll) {
            scrollStoryMovePoint = scrollStoryMovePoint + operandStory;
        }
    } else if (event.target.classList.contains("prev")) {
        if (0 < scrollStoryMovePoint) {
            scrollStoryMovePoint = scrollStoryMovePoint - operandStory;
        }
    }

    // Move the scroll bar to the value.
    wrapperStory.scroll(scrollStoryMovePoint, 0);
}
nxt_btn.addEventListener("click", testStory);
prev_btn.addEventListener("click", testStory);




//    switch to best friends post
var stop_bg = function () {
    document.querySelector('body').style.overflowY = "hidden";
}
var auto_bg = function () {
    document.querySelector('body').style.overflowY = "auto";
}

var select_list = document.getElementById('s_lists').querySelectorAll('.select_tl');
for (var i = select_list.length - 1; i >= 0; --i) {
    select_list[i].addEventListener("click", function () {
        var id = this.getAttribute('cd');
        if (this.querySelector('.select_me').classList.contains('select_me_selected')) {
            my_ajax("./php/choose_category.php", "ct=" + id + "&action=delete");
        } else {
            my_ajax("./php/choose_category.php", "ct=" + id + "&action=add");
        }
        this.querySelector('.select_me').classList.toggle('select_me_selected');
        this.querySelector('.select_me').querySelector('div').classList.toggle('display_flex');
    })
}


document.querySelector("#my_options").addEventListener("click", function () {
    document.querySelector(".my_options").style.display = "none";
    auto_bg();
})

document.querySelector("#alter_posts").addEventListener("click", function () {
    document.querySelector(".my_options").style.display = "flex";
    //        document.querySelector(".items").style.animation = "show_alter_timeline";
    //        document.querySelector(".items").style.animationDuration = ".3s";
    stop_bg();
});








//});

//open post options
var ftp = document.getElementById('post_option_fst');
var user_name = 0;
var active_post = 0;

function open_post_options(owner_id, owner_name, post_id, privacy) {
    ftp.classList.add('active');
    stop_bg();
    user_at = owner_id;
    user_name = owner_name;
    active_post = post_id;
    active_privacy = privacy;
    var chk_follow = document.querySelector('.fllw_' + owner_id).innerHTML;
    var oper_at = document.getElementById('unflww').querySelector('b');
    var img_flw = document.getElementById('unflww').querySelector('img');
    if (chk_follow === ' • Follow ') {
        oper_at.innerHTML = "Follow";
        img_flw.setAttribute('src','./SVG/heart-solid.svg')
    } else if (chk_follow === ' • Requested ') {
        oper_at.innerHTML = "Cancel follow request";
        img_flw.setAttribute('src','./SVG/heart-broken-solid.svg')
    } else {
        oper_at.innerHTML = "Unfollow";
        img_flw.setAttribute('src','./SVG/heart-broken-solid.svg')
    }
     var chk_mute = document.querySelector('.unmt_' + owner_id).innerHTML;
var oper_at_mute = document.getElementById('mutww').querySelector('b');
var img_mute = document.getElementById('mutww').querySelector('img');
    if(chk_mute===' • Unmute '){
        oper_at_mute.innerHTML = 'Unmute posts'
        img_mute.setAttribute('src','./SVG/volume-up-solid.svg')
    }else{
        oper_at_mute.innerHTML = 'Mute posts'
        img_mute.setAttribute('src','./SVG/volume-mute-solid.svg')
    }
}
  
//close post options 
function close_options(post_id) {
    document.querySelector("#post_option" + post_id).classList.remove('active')
    auto_bg();
}



// hyperlink animation
var href_click_animation = function () {
    var links = document.getElementsByTagName('a');
    for (var i = 0; i < links.length; i++) {
        links[i].addEventListener("click", function (e) {
            if (this.getAttribute('href') != "#") {
                document.querySelector(".loader").style.display = "flex";
            }
        })
    }
}

var isChromium = window.chrome;
var winNav = window.navigator;
var vendorName = winNav.vendor;
var isOpera = typeof window.opr !== "undefined";
var isIEedge = winNav.userAgent.indexOf("Edge") > -1;
var isIOSChrome = winNav.userAgent.match("CriOS");

if (isIOSChrome) {
    //  href_click_animation();
    //   window.alert("chrome ");
} else if (
    isChromium !== null &&
    typeof isChromium !== "undefined" &&
    vendorName === "Google Inc." &&
    isOpera === false &&
    isIEedge === false
) {
    href_click_animation();
    //   window.alert("chrome ");
} else {
    //   window.alert("chrome not found");
}
if (navigator.vendor && navigator.vendor.indexOf('Apple') > -1 &&
    navigator.userAgent &&
    navigator.userAgent.indexOf('CriOS') == -1 &&
    navigator.userAgent.indexOf('FxiOS') == -1
) {
    //  href_click_animation();
    // window.alert("safari ");
} else {
    //   window.alert("safari not found");
}

if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {
    // href_click_animation();
    // window.alert("firefox ");
} else {
    //   window.alert("firefox not found");
}


// pwa
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('JS/sw.js').then(reg => {
        console.log("Service Worker registered successfully");
    }).catch(err => {
        console.log("Service Worker error", err);
    })
}




//search result

//   hide mobile nav bar at the time of search
document.querySelector("#search_mob").addEventListener("click", function () {
    hide_mob_nb();
});

var search = function (click_elm, search_word) {
    click_elm.addEventListener("click", function () {
        if (window.location.hash !== "#searching") {
            history.pushState("", "", window.location.href + '#searching');
            window.location.hash = "#searching";
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    document.querySelector(".homepage-main-content").style.display = "none";
                    document.querySelector("#search_content").style.display = "block";
                    document.querySelector(".loader").style.display = "none";

                    document.getElementById("search_rs").innerHTML += this.responseText;
                } else {
                    document.querySelector(".loader").style.display = "flex";
                }
            };
            xhttp.open("GET", "./search", true);
            xhttp.send();
        }
        // scroll top
        document.body.scrollTop = 0; // For Safari
        document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    })
    document.body.scrollTop = 0;
}
search(document.getElementById("search_des"), "countries");
search(document.getElementById("search_mob"), "countries");

function searching(a) {
    a.addEventListener("input", function () {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {

                var profiles = "";
                //            window.alert(this.responseText);
                var output = JSON.parse(this.responseText);

                for (var i = 0; i < output.post.length; i++) {
                    if (output.post[i].requested == 1) {
                        var following = "hide";
                        var not_following = "";

                    } else {
                        var not_following = "hide";
                        var following = "";
                    }
                    if (output.post[i].account_type == 1) {
                        var follow = "REQUESTED";
                    } else {
                        var follow = "FOLLOWING";
                    }
                    if (output.post[i].following == 1) {
                        var followers = "following";
                        var follow_button = '<a href="./profile"><button class="connect-btn green_bg">VIEW PROFILE</button></a>';
                        var follow_mob = '<a ><img  src="./SVG/arrow-right-solid.svg" alt="" </a>';

                    } else {
                        var followers = output.post[i].followers + " followers";
                        var hide = "";
                        var follow_button = '<button class="connect-btn user_send_' + output.post[i].user_id + ' ' + following + ' ' + hide + '" onclick="follow_me(' + output.post[i].user_id + ',' + output.post[i].account_type + ',1)">FOLLOW</button><button class="connect-btn connect-btn-af user_sending_' + output.post[i].user_id + ' ' + not_following + ' ' + hide + '" onclick="follow_me(' + output.post[i].user_id + ',1,0)">' + follow + '</button>';
                        var follow_mob = '<img class="user_s_' + output.post[i].user_id + ' ' + following + '" src="./SVG/user-plus-solid.svg" alt="" onclick="follow_me(' + output.post[i].user_id + ',' + output.post[i].account_type + ',1)"><img class="user_sing_' + output.post[i].user_id + ' ' + not_following + '" src="./SVG/user-plus-solid-blue.svg" alt="" onclick="follow_me(' + output.post[i].user_id + ',1,0)">';
                    }
                    if(output.post[i].profile_img){
                        var profile_img = output.post[i].profile_img;
                    }else{
                        var profile_img = 'none.svg';
                    }


                    profiles += '<div class="card-main res"><div class="img-wrap "><img class="circle" src="profile/i/'+ profile_img + '" alt=""></div><div class="info"><h1><a href="./profile" target="_blank">' + output.post[i].name + '</a><span> • ' + followers + ' </span></h1><p>' + output.post[i].intro + '</p><img class="loc-icon" src="./search/SVG/map-marker-alt-solid.svg" alt=""><span class="location"> ' + output.post[i].location + ' </span><br></div><div class="last">' + follow_button + '<button class="connect-icon ">' + follow_mob + ' </button></div></div>';
                }
                document.getElementById("search_rs").innerHTML = profiles;

            } else {
                //                  show page loading animation
            }
        };
        var value = a.value;
        xhttp.open("GET", "./search/index.php?s=" + value, true);
        xhttp.send();
    })
}

searching(document.getElementById("search_des"));
searching(document.getElementById("search_mob"));



function hashHandler() {
    if (window.location.hash !== "#searching") {
        document.querySelector(".homepage-main-content").style.display = "block";
        document.querySelector("#search_content").style.display = "none";
    } else if (window.location.hash === "#searching") {
        document.querySelector(".homepage-main-content").style.display = "none";
        document.querySelector("#search_content").style.display = "block";
    }
}
window.addEventListener('hashchange', hashHandler, false);
if (window.location.hash === "#searching") removeHash();

function removeHash() {
    history.pushState("", document.title, window.location.pathname + window.location.search);
}

function follow_me(user_id, privacy, action) {
    document.querySelector(".user_send_" + user_id).classList.toggle("hide");
    document.querySelector(".user_sending_" + user_id).classList.toggle("hide");
    document.querySelector(".user_s_" + user_id).classList.toggle("hide");
    document.querySelector(".user_sing_" + user_id).classList.toggle("hide");
    my_ajax("./php/follow_me.php", "user_id=" + user_id + "&privacy=" + privacy + "&action=" + action);
}



//save the post

function save_me(post_id) {
    var check_reaction_s = document.querySelector("#like_" + post_id);
    if (document.querySelector("#save_" + post_id).classList.contains("saved")) {

        if (
            check_reaction_s.classList.contains("liked_done") ||
            check_reaction_s.classList.contains("loved_done") ||
            check_reaction_s.classList.contains("supported_done") ||
            check_reaction_s.classList.contains("celebrated_done") ||
            check_reaction_s.classList.contains("fired_done") ||
            check_reaction_s.classList.contains("haha_done") ||
            check_reaction_s.classList.contains("sad_done")
        ) {
            console.log("update kro unsave krne ke liye");
            my_ajax("./php/post_save.php", "post_id=" + post_id + "&action=update&save=0");
        } else {
            console.log("delete kro whole line");
            my_ajax("./php/post_save.php", "post_id=" + post_id + "&action=delete&save=1");
        }
        //        console.log('call event to unsave ' + post_id);
        //        my_ajax("./php/post_save.php", "post_id=" + post_id + "&action=delete");
    } else {
        if (
            check_reaction_s.classList.contains("liked_done") ||
            check_reaction_s.classList.contains("loved_done") ||
            check_reaction_s.classList.contains("supported_done") ||
            check_reaction_s.classList.contains("celebrated_done") ||
            check_reaction_s.classList.contains("fired_done") ||
            check_reaction_s.classList.contains("haha_done") ||
            check_reaction_s.classList.contains("sad_done")
        ) {
            console.log("upadate kr na to save post");
            my_ajax("./php/post_save.php", "post_id=" + post_id + "&action=update&save=1");
        } else {
            console.log("insert kr na save to save post");
            my_ajax("./php/post_save.php", "post_id=" + post_id + "&action=insert&save=1");
        }


        //        console.log('call event to save' + post_id);
        //        my_ajax("./php/post_save.php", "post_id=" + post_id + "&action=save")
    }
    document.querySelector("#save_" + post_id).classList.toggle('saved');
}


//double click love react
function double_click_love(post_id) {
    if (document.querySelector("#like_" + post_id).classList.contains("loved_done")) {
        removereaction(post_id);
        my_ajax("./php/post_like.php", "post_id=" + post_id + "&action=delete");
        console.log('call event to remove love at' + post_id);
        document.querySelector("#like_" + post_id).classList.remove('loved_done');
    } else {
        other_reactions(post_id, 3);
        removereaction(post_id);
        console.log('call event to love at' + post_id);
        document.querySelector("#like_" + post_id).classList.add('loved_done');
    }
    //   window.alert("love reaction at post :  "+post_id);
}

//prevent image right click
var img_all = document.querySelectorAll('img');
for (var i = 0; i < document.querySelectorAll('img').length; i++) {
    document.querySelectorAll('img')[i].oncontextmenu = function () {
        return false;
    };
}
// example <img src="a.png" oncontextmenu="return false;">




//ajax
function my_ajax(url, post_data, container) {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            if (container) {
                document.querySelector(container).innerHTML += this.responseText;
            }
            console.log(this.responseText);
            load_more = true;
        }
    };
    if (post_data) {
        xhttp.open("POST", url, true);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(post_data);
    } else {
        xhttp.open("GET", url, true);
        xhttp.send();
    }
}
// call ajax
//my_ajax("./php/post_like.php","post_id=100&action=delete","body");




//show comment option
function show_comment(post_id) {
    document.querySelector("#comment_" + post_id).classList.toggle("comment_show");
    hide_mob_nb();
}

//submit comment
function submit_comment(event, post_id) {
    event.preventDefault();
    var text = document.querySelector("#comment_input_" + post_id).value;
    if (text.length > 0) {
        if (document.querySelector("#load_comments_" + post_id).querySelector('.load_comments')) {
            var already_exist = document.querySelector("#load_comments_" + post_id).querySelector('.load_comments').innerHTML;
        } else var already_exist = "";
        my_ajax("./php/comment.php", "post_id=" + post_id + "&text=" + text + "");
        document.querySelector("#load_comments_" + post_id).innerHTML = '<div class="load_comments">' + already_exist + '<div class="follow-conn"><img src="./Images/profile-pic4.jpg" class="follow-icon comment_profile" /><span href="profile/" class="comment_form commented"><div class="comment_input commented_input"> ' + text + '</div></span></div></div>';
        document.querySelector("#comment_input_" + post_id).value = "";
        document.querySelector("#comment_input_" + post_id).style.height = "auto";
    }
    //    show_comment(post_id);show_comment(post_id);
}



//auto expandable textarea
//var textarea = document.querySelector('textarea');
//textarea.addEventListener('keydown', autosize);           
function autosize(id) {
    setTimeout(function () {
        el = document.getElementById('comment_input_' + id)
        el.style.cssText = 'height:auto; padding:.75em 1em';
        el.style.cssText = 'height:calc(' + (el.scrollHeight) + 'px +  2px);';
    }, 100);
}




//hide mobile navs 1
let scroll = 1;
let scrolldown = 1;



//load more posts json
var load_m = 1;
var t = 1;
var max_id = 100000000000;
window.onscroll = function (ev) {
    if ((window.innerHeight + window.scrollY + 3000) >= document.body.offsetHeight && window.location.hash !== "#searching") {

        if (load_m) {
            load_m = 0;
            console.log('bottom');

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {

                if (this.readyState == 4 && this.status == 200) {

                    var my_adds = "";

                    var output = JSON.parse(this.responseText);
                    for (var i = 0; i < output.post.length; i++) {
                        var slidrr = "";
                        var sa = '<div id="slider_' + output.post[i].id + '" class="slider loaded" post_id="' + output.post[i].id + '" > <div class="wrapper"> <span id="prev_' + output.post[i].id + '" class="control prev"></span> <span id="next_' + output.post[i].id + '" class="control next"></span> <div id="items_' + output.post[i].id + '" class="items_slider"> ';
                        var sb = '</div></div> </div>';
                        for (var im = 0; im < output.post[i].body_img_urls.length; im++) {
                            slidrr += '<img src="' + output.post[i].body_img_urls[im] + '" class="slide" id="img' + output.post[i].id + "img" + im + '" oncontextmenu="this.requestFullscreen()"> ';

                        }
                        if (output.post[i].body_img_urls.length <= 1) {
                            sa = "";
                            sb = "";
                        }
                        if(output.post[i].following!=1){
                           follow_integ = " • Follow ";
                           }else{
                               follow_integ='';
                           } 
                        if(output.post[i].mute==1){
                           mute_integ = " • Unmute ";
                           }else{
                               mute_integ='';
                           }
                        if(output.post[i].tag){
                           tagshow = "• "+output.post[i].tag;
                           }else{
                               tagshow='';
                           }
                        var react_types = '';
                        for (var m = 0; m < output.post[i].reaction_type.length; m++) {
                            if (m < 3) {
                                if (output.post[i].reaction_type[m] == 1) {
                                    react_types += '<span class="icon like-icon"></span>';
                                } else if (output.post[i].reaction_type[m] == 2) {
                                    react_types += '<span class="icon love-icon"></span>';
                                } else if (output.post[i].reaction_type[m] == 3) {
                                    react_types += '<span class="icon support-icon"></span>';
                                } else if (output.post[i].reaction_type[m] == 4) {
                                    react_types += '<span class="icon celebrate-icon"></span>';
                                } else if (output.post[i].reaction_type[m] == 5) {
                                    react_types += '<span class="icon fire-icon"></span>';
                                } else if (output.post[i].reaction_type[m] == 6) {
                                    react_types += '<span class="icon haha-icon"></span>';
                                } else if (output.post[i].reaction_type[m] == 7) {
                                    react_types += '<span class="icon sad-icon"></span>';
                                }
                            }
                        }
                        console.log(react_types)
                        max_id = output.post[i].id;
                        

                        my_adds = '<div class="card card_own_' + output.post[i].owner_id + '" post_id="' + output.post[i].id + '"> <div class="follow-conn"> <img src="' + output.post[i].profile_url + '" class="follow-icon users" oncontextmenu="this.requestFullscreen()"/> <div class="conn-name"> <span> <b>' + output.post[i].name + ' <small class="u_c_' + output.post[i].owner_id + '">' + tagshow + '</small> <small class="fllw_' + output.post[i].owner_id + '" onclick="unfollow_ys(' + output.post[i].owner_id + ',' + output.post[i].account_type + ')">'+follow_integ+'</small><small class="unmt_' + output.post[i].owner_id + '" onclick="mute_ys(' + output.post[i].owner_id + ')">'+mute_integ+'</small> </b> </span> <span>' + output.post[i].introduction + '</span> <span> <span>' + output.post[i].time + ' • ' + ' post id : ' + output.post[i].id +' loc: '+ output.post[i].location + ' </span>  </span> </div> <span class="icon more-icon top-corner" id="more_post_click" onclick="open_post_options(' + output.post[i].owner_id + ', ' + "'" + output.post[i].name + "'" + ',' + output.post[i].id + ',' + output.post[i].account_type + ')"></span> </div><div class="post_raw_body" ondblclick="double_click_love(' + output.post[i].id + ')"> <p class="content select_text"> ' + output.post[i].body_text + ' </p> ' +
                            sa + slidrr + sb +
                            '</div> <div class="vote-section" > '+react_types+' <span class="votes">' + output.post[i].like + '</span> <div class=" post-slider-dots post-slider-dots_' + output.post[i].id + '"></div> <span> ' + output.post[i].comment + ' Comments</span> </div> <div class="share-section"  > <div class="icon-wrap open_reactions ' + output.post[i].reaction + '" id="like_' + output.post[i].id + '"> <div class="like_option"> <div class="set_it"> <img src="./emogi/other/compressed/thumbs_up.gif" title="Like" class="like_inner" /> <img src="./emogi/other/compressed/sparkling_heart.gif" title="Love" class="love_inner" /> <img src="./emogi/other/compressed/handshake.gif" title="Support" class="support_inner " /> <img src="./emogi/other/compressed/party_popper.gif" title="Celebrate" class="cele_inner" /> <img src="./emogi/other/compressed/fire.gif" title="Hot" class="hot_inner" /> <img src="./emogi/other/compressed/beaming_face_with_smiling_eyes.gif" title="Laugh" class="smile_inner" /> <img src="./emogi/other/compressed/crying_face.gif" title="Sad" class="sad_inner" /> </div> </div> <div class="flex"> <img src="./emogi/128/human/thumbs-up-medium-light-skin-tone.png" class="icon like-i default"> <span class="default">Like&nbsp;</span> <img src="./emogi/other/compressed/thumbs_up.gif" class="icon like-i liked"> <span class="liked">Liked</span> <img src="./emogi/other/compressed/sparkling_heart.gif" class="icon loved"> <span class="loved">Loved</span> <img src="./emogi/other/compressed/handshake.gif" class="icon supported"> <span class="supported">Supported</span> <img src="./emogi/other/compressed/party_popper.gif" class="icon celebrated"> <span class="celebrated">celebrated</span> <img src="./emogi/other/compressed/fire.gif" class="icon fired"> <span class="fired">Hot</span> <img src="./emogi/other/compressed/beaming_face_with_smiling_eyes.gif" class="icon haha"> <span class="haha">HaHa</span> <img src="./emogi/other/compressed/crying_face.gif" class="icon sad"> <span class="sad">Sad</span> </div> </div> <div class="icon-wrap" onclick="show_comment(' + output.post[i].id + ')"> <img src="./SVG/comment.svg" class="icon comment-icon" /> <span>Comment</span> </div> <div class="icon-wrap ' + output.post[i].save + '" id="save_' + output.post[i].id + '" onclick="save_me(' + output.post[i].id + ')"> <img src="./SVG/save.svg" class="icon send-icon" /><span>Save&nbsp;</span> <img src="./SVG/saved.svg" class="icon send-icon saved_done" /> <span class="saved_done ">Saved</span> </div> </div> <div id="load_comments_' + output.post[i].id + '"></div> <form class="follow-conn comment_attempt " id="comment_' + output.post[i].id + '" onsubmit="submit_comment(event,' + output.post[i].id + ')"><img src="./Images/profile-pic4.jpg" class="follow-icon comment_profile" /><span href="profile/" class="comment_form"><textarea type="text" rows="1" class="comment_input" id="comment_input_' + output.post[i].id + '" value="o" placeholder="Leave your comment..." onkeydown="autosize(' + output.post[i].id + ')"></textarea></span><button class="follow post_comment">Post</button></form> </div> ';
                        load_m = 1;
                        document.getElementById("new_posts").insertAdjacentHTML("beforeend", my_adds);
                        if (document.getElementById('slider_' + output.post[i].id)) {
                            slide(output.post[i].id, document.getElementById('slider_' + output.post[i].id), document.getElementById('items_' + output.post[i].id), document.getElementById('prev_' + output.post[i].id), document.getElementById('next_' + output.post[i].id));
                        }
                        reaction(output.post[i].id);
                    }
                }
            };

            xhttp.open("GET", "./php/next.php?f="+po_st_type+"&s=" + max_id, true);
            console.log("./php/next.php?f="+po_st_type+"&s=" + max_id)
            xhttp.send();
            t++;
        }

    }

    //hide mobile navs 2
    if (this.oldScroll > this.scrollY) {
        scroll++;
        scrolldown = 1;
        if (scroll > 20 || window.pageYOffset < 60) {
            //   scrolling show
            document.querySelector(".mobile-header").style.top = "0";
            document.querySelector(".mobile-nav-bar").style.bottom = "0";
            scroll = 1;
        }
    } else {
        //   scrolling hide
        scrolldown++;
        scroll = 1;
        if (scrolldown > 20 && window.pageYOffset > 60) {
            document.querySelector(".mobile-header").style.top = "-52px";
            document.querySelector(".mobile-nav-bar").style.bottom = "-55px";
            scrolldown = 1;
        }
    }
    this.oldScroll = this.scrollY;


};


//open lists
function openlist(click_point) {
    document.querySelector('.active_name').innerHTML = user_name;
    document.getElementById('post_option'+click_point).classList.add('active');
    close_options('_fst');
    stop_bg();
}


//change list
var user_at = 0;

function changelist(id, id_nme, delete_) {
    my_ajax("./manage_people/relation.php", 'change_list=1&user=' + user_at + '&list=' + id);
    if (delete_) {
        my_ajax("./manage_people/relation.php", 'change_list=1&user=' + user_at + '&list=delete');
    }
    var a_name_spn = document.querySelectorAll('.u_c_' + user_at);
    for (var i = 0; i < a_name_spn.length; i++) {
        if (id_nme) {
            a_name_spn[i].innerHTML = "• " + id_nme;
        } else {
            a_name_spn[i].innerHTML = '';
        }
    }
    close_options('yy');
}


//ignone user
function ignore(id){
    document.querySelector('.suggest_'+id).classList.add('reject');
    my_ajax("./manage_people/relation.php", 'ignore=1&user=' + id );
}

//folow user from suggestion box
function follow_ya(id,  privacy){
    if(document.querySelector('.flw_btn_'+id).innerHTML === "Follow"){
        if(privacy){
        document.querySelector('.flw_btn_'+id).innerHTML = "Requested";
        }else{
        document.querySelector('.flw_btn_'+id).innerHTML = "Following";
        }
           my_ajax("./manage_people/relation.php", 'i=follow&user=' + id );
    }else{
        document.querySelector('.flw_btn_'+id).innerHTML = "Follow";
         my_ajax("./manage_people/relation.php", 'i=unfollow&user=' + id );
    }
    
    document.querySelector('.flw_btn_'+id).classList.toggle('follow-button-alt');
    my_ajax("./manage_people/relation.php", 'ignore=1&user=' + id );
}

//unfollow user from posts
function unfollow_ys(id,privacy){
    var select_owner = document.querySelectorAll('.fllw_'+id)
    if(select_owner[0].innerHTML===" • Follow "){
          my_ajax("./manage_people/relation.php", 'i=follow&user=' + id );
        for(var i = 0 ; i < select_owner.length;i++){
            if(privacy==1){
                select_owner[i].innerHTML = " • Requested ";
            }else{
                select_owner[i].innerHTML = " • Following ";
            }
        
    }
    }else if(select_owner[0].innerHTML===" • Following "||select_owner[0].innerHTML===" • Requested "){
             my_ajax("./manage_people/relation.php", 'i=unfollow&user=' + id );
        for(var i = 0 ; i < select_owner.length;i++){
        select_owner[i].innerHTML = " • Follow ";
    }
             }
}
//mute user from posts
function mute_ys(id){
    var select_owner = document.querySelectorAll('.unmt_'+id)
    if(select_owner[0].innerHTML===" • Unmute "){
        my_ajax("./manage_people/relation.php", 'mute_post=1&value=0&user=' + id );
            for(var i = 0 ; i < select_owner.length;i++){
        select_owner[i].innerHTML = " • Mute ";
    }
    }else if(select_owner[0].innerHTML===" • Mute "){
        my_ajax("./manage_people/relation.php", 'mute_post=1&value=1&user=' + id );
         for(var i = 0 ; i < select_owner.length;i++){
        select_owner[i].innerHTML = " • Unmute ";
    }
    }
}
//report post from posts
function report_post(){
     my_ajax("./manage_people/relation.php", 'report_post=1&post_id=' + active_post );
   close_options('_report')
}




//unfollow user from posts
function unfollow_yes() {
    var select_owner = document.querySelectorAll('.fllw_' + user_at);
    var getinner = document.getElementById('unflww').querySelector('b').innerHTML;
    var show_outpt = '';
    if (getinner === 'Unfollow') {
       
        if(active_privacy == 1){
            openlist('_unfollow');
        }else{
            my_ajax("./manage_people/relation.php", 'i=unfollow&user=' + user_at);
        show_outpt = ' • Follow '; 
        }
    } else if (getinner === 'Follow') {
        my_ajax("./manage_people/relation.php", 'i=follow&user=' + user_at);
        if (active_privacy == 1) {
            show_outpt = ' • Requested ';
        } else {
            show_outpt = ' • Following ';
        }
    } else if (getinner === 'Cancel follow request') {
        my_ajax("./manage_people/relation.php", 'i=unfollow&user=' + user_at);
        show_outpt = ' • Follow ';
    }
    for (var i = 0; i < select_owner.length; i++) {
        select_owner[i].innerHTML = show_outpt;
    }

    close_options('_fst');
}

//mute user from posts
function mute_yes(){
//    var select_owner = document.querySelectorAll('.card_own_'+user_at)
//    for(var i = 0 ; i < select_owner.length;i++){
////        select_owner[i].classList.add('reject2');
//    }
    
    var getinner = document.getElementById('mutww').querySelector('b').innerHTML;
    var select_owner = document.querySelectorAll('.unmt_'+user_at)
    if(getinner==='Mute posts'){
        my_ajax("./manage_people/relation.php", 'mute_post=1&value=1&user=' + user_at );
        for(var i = 0 ; i < select_owner.length;i++){
        select_owner[i].innerHTML = " • Unmute ";
    }
    }else if(getinner==='Unmute posts'){
        my_ajax("./manage_people/relation.php", 'mute_post=1&value=0&user=' + user_at );
        for(var i = 0 ; i < select_owner.length;i++){
        select_owner[i].innerHTML = " • Mute ";
    }
    }else{
        window.alert(8)
    }
    
//     my_ajax("./manage_people/relation.php", 'mute_post=1&value=1&user=' + user_at );
close_options('_fst');
}


function confirm_unfollow(){
     my_ajax("./manage_people/relation.php", 'i=unfollow&user=' + user_at);
    var select_owner = document.querySelectorAll('.card_own_' + user_at);
    
    for (var i = 0; i < select_owner.length; i++) {
        select_owner[i].setAttribute('class','reject2')
    }
    close_options('_unfollow')
}






